import aiohttp
import logging

class ServerConnection:
    def __init__(self, server_url, mac_address):
        self.server_url = server_url
        self.mac_address = mac_address

    async def connect(self):
        """
        Essaie de se connecter au serveur IPTV de manière asynchrone.

        :return: True si la connexion est réussie, False sinon
        """
        headers = {
            'User-Agent': 'Mozilla/5.0',
            'X-MAC-Address': self.mac_address
        }
        try:
            async with aiohttp.ClientSession() as session:
                async with session.get(self.server_url, headers=headers, timeout=20) as response:
                    logging.info(f"Response status: {response.status} for MAC {self.mac_address} at {self.server_url}")
                    return response.status == 200
        except aiohttp.ClientError as e:
            logging.error(f"Erreur de connexion pour MAC {self.mac_address} à {self.server_url}: {e}")
            return False